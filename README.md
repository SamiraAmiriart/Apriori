# Apriori

def subsets(arr):
تابع subsets(arr) به منظور تولید زیرمجموعه‌های غیر تهی از یک آرایه استفاده می‌کنیم. در الگوریتم Apriori، این زیرمجموعه‌ها برای پیدا کردن آیتم‌ست‌های پرتکرار در دیتاست استفاده می‌شوند. هر آیتم‌ست شامل یک یا چند آیتم است که در ترکیب‌های مختلف در تراکنش‌ها ظاهر می‌شوند.
به طور خاص، این تابع تمامی ترکیب‌های ممکن از آیتم‌های موجود در آرایه را تولید می‌کند و این ترکیب‌ها می‌توانند به عنوان کاندیداهای اولیه برای جستجوی آیتم‌ست‌های پرتکرار در دیتاست مورد استفاده قرار گیرند. این فرآیند یکی از مراحل کلیدی در الگوریتم Apriori است که باعث می‌شود تعداد آیتم‌ست‌ها به مرور کاهش یابد و تنها آیتم‌ست‌های پرتکرار باقی بمانند.
به زبان ساده‌تر، این تابع به الگوریتم Apriori کمک می‌کند تا همه ترکیب‌های ممکن از آیتم‌ها را بررسی کند و تنها آن‌هایی که به طور مداوم در داده‌ها ظاهر می‌شوند را شناسایی و ذخیره کند.
def returnItemsWithMinSupport(itemSet, transactionList, minSupport, freqSet):

تابع returnItemsWithMinSupport  در الگوریتم Apriori برای محاسبه حمایت (Support) آیتم‌ها استفاده می‌شود و زیرمجموعه‌ای از itemset  را باز می‌گرداند که هر کدام از عناصر آن حداقل حمایت مشخص شده را داشته باشند.
این فرآیند به الگوریتم Apriori کمک می‌کند تا به تدریج مجموعه کاندیداهای آیتم‌ها را کاهش دهد و تنها آیتم‌ست‌های پرتکرار و با اهمیت باقی بمانند، که برای شناسایی الگوهای پرتکرار در دیتاست ضروری است.
def joinSet(itemSet, length): 
تابع joinSet(itemSet, length)  در الگوریتم Apriori برای تولید مجموعه‌های آیتمی جدید با طول مشخص به کار می‌رود. این تابع به طور خاص مجموعه آیتم‌ها را با خودشان ترکیب می‌کند تا مجموعه‌های بزرگ‌تری با طول مشخص ایجاد کند.

def getItemSetTransactionList(data_iterator): 
تابع getItemSetTransactionList(data_iterator)  در الگوریتم Apriori برای پردازش داده‌ها و ایجاد مجموعه‌ای از تراکنش‌ها و آیتم‌ها استفاده می‌شود. این تابع به طور خاص دو خروجی اصلی تولید می‌کند: لیست تراکنش‌ها و مجموعه آیتم‌های منفرد. 
مراحل تابع:
1.	ایجاد لیست تراکنش‌ها:
o	هر تراکنش از داده‌های ورودی گرفته شده و به صورت یک frozenset  به transactionList  افزوده می‌شود.
2.	ایجاد مجموعه آیتم‌های منفرد:
o	در هر تراکنش، تمامی آیتم‌های منفرد استخراج شده و به itemset  افزوده می‌شوند. هر آیتم به صورت یک frozenset  تک‌عنصری ذخیره می‌شود.
3.	بازگشت مقادیر:
o	تابع در نهایت itemset  و transactionList  را باز می‌گرداند که در مراحل بعدی الگوریتم برای تولید آیتم‌ست‌های پرتکرار و تعیین حمایت آنها استفاده می‌شوند.
این تابع برای شروع فرآیند الگوریتم Apriori ضروری است و به آماده‌سازی داده‌ها کمک می‌کند تا الگوریتم بتواند به طور مؤثر آیتم‌ست‌های پرتکرار را شناسایی کند.
def runApriori(data_iter, minSupport, minConfidence): 
تابع runApriori  یک پیاده‌سازی کامل از الگوریتم Apriori است که داده‌ها را پردازش می‌کند و آیتم‌ست‌های پرتکرار و قوانین انجمنی مرتبط را پیدا می‌کند. 
این تابع به صورت کلی، الگوریتم Apriori را پیاده‌سازی کرده و امکان می‌دهد تا آیتم‌ست‌های پرتکرار و قوانین انجمنی را به سادگی از داده‌های ورودی استخراج کنید.
def getSupport(item): 
تابع getSupport(item)  و بخش‌های بعدی که توضیح داده‌اید، در الگوریتم Apriori برای محاسبه حمایت (Support) آیتم‌ست‌ها و استخراج قوانین انجمنی (Association Rules) استفاده می‌شوند. 
getSupport(item):
تابع getSupport(item)  میزان حمایت (Support) یک آیتم یا آیتم‌ست را محاسبه می‌کند. حمایت به عنوان نسبت تعداد تراکنش‌هایی که شامل آن آیتم هستند به کل تعداد تراکنش‌ها تعریف می‌شود.
 toRetItems:
این بخش آیتم‌ست‌های پرتکرار را که حداقل حمایت مورد نیاز را دارند، جمع‌آوری و در قالب یک لیست بازمی‌گرداند:
1.	حلقه اول تمام آیتم‌ست‌های پرتکرار در  largeSet را مرور می‌کند.
2.	با استفاده از تابع getSupport(item)، حمایت هر آیتم‌ست محاسبه می‌شود.
3.	آیتم‌ست و حمایت آن به لیست toRetItems  افزوده می‌شوند.
toRetRules:
این بخش قوانین انجمنی را استخراج و در قالب یک لیست بازمی‌گرداند:
1.	حلقه دوم از تمامی آیتم‌ست‌های پرتکرار، به جز آیتم‌ست‌های تک‌عنصری، عبور می‌کند.
2.	برای هر آیتم‌ست، تمامی زیرمجموعه‌های آن تولید می‌شوند.
3.	برای هر زیرمجموعه، تفاوت با آیتم‌ست اصلی (یعنی باقی‌مانده) محاسبه می‌شود.
4.	اگر حمایت باقی‌مانده و آیتم‌ست اصلی محاسبه شوند، ضریب اطمینان (Confidence) نیز محاسبه می‌شود.
5.	اگر ضریب اطمینان بیشتر از حداقل اطمینان (minConfidence) باشد، قانون انجمنی به لیست toRetRules افزوده می‌شود.
در نهایت، این تابع دو لیست را بازمی‌گرداند:
1.	toRetItems  شامل آیتم‌ست‌های پرتکرار و حمایت آن‌ها.
2.	toRetRules  شامل قوانین انجمنی و ضریب اطمینان آن‌ها.
این فرآیند کمک می‌کند تا الگوهای پرتکرار و روابط بین آیتم‌ها را در دیتاست شناسایی و استخراج کنید.
def printResults(items, rules): 
تابع printResults(items, rules)  در الگوریتم Apriori برای نمایش آیتم‌ست‌های پرتکرار و قوانین انجمنی به کار می‌رود. این تابع به طور خاص، آیتم‌ست‌ها را بر اساس حمایت (Support) و قوانین را بر اساس ضریب اطمینان (Confidence) مرتب می‌کند و نتایج را به صورت خوانا چاپ می‌کند.
این تابع کمک می‌کند تا نتایج الگوریتم Apriori به شکلی خوانا و مرتب نمایش داده شوند، که این امر برای تحلیل و تفسیر نتایج بسیار مفید است. با استفاده از این تابع، می‌توان به راحتی آیتم‌ست‌های پرتکرار و قوانین انجمنی مهم را شناسایی و مورد استفاده قرار داد.
def to_str_results(items, rules): 
تابع to_str_results(items, rules)  در الگوریتم Apriori به منظور تبدیل آیتم‌ست‌های پرتکرار و قوانین انجمنی به رشته‌های قابل چاپ استفاده می‌شود. به طور دقیق‌تر، این تابع آیتم‌ست‌ها و قوانین را مرتب می‌کند و آنها را در قالبی خوانا و مرتب برای نمایش آماده می‌نماید.
این تابع به منظور آماده‌سازی نتایج برای نمایش یا ذخیره در قالب‌های مختلف مورد استفاده قرار می‌گیرد. با استفاده از این تابع، نتایج الگوریتم Apriori به شکلی خوانا و قابل‌درک ارائه می‌شوند که می‌توانند برای تحلیل‌های بیشتر یا گزارش‌گیری استفاده شوند.
def dataFromFile(fname='DataWorlds.csv'): 
تابع dataFromFile(fname='DataWorlds.csv')  در الگوریتم Apriori برای خواندن داده‌ها از یک فایل و تبدیل آنها به فرمت مناسبی برای پردازش توسط الگوریتم استفاده می‌شود. 
این تابع به آماده‌سازی داده‌ها برای الگوریتم Apriori کمک می‌کند. با استفاده از این تابع، داده‌ها از فایل خوانده شده و به صورت مجموعه‌های ثابت (frozenset) ذخیره می‌شوند که برای پردازش توسط الگوریتم بسیار مناسب است. این فرآیند به الگوریتم اجازه می‌دهد که به سادگی تراکنش‌ها را مرور کند و آیتم‌ست‌های پرتکرار را شناسایی نماید.
عملکرد بخش Main():
if __name__ == "__main__":
در الگوریتم Apriori برای مدیریت اجرای اصلی برنامه استفاده می‌شود و به عنوان نقطه ورود اصلی به برنامه عمل می‌کند. در اینجا، عملکرد دقیق هر قسمت از این بخش را توضیح می‌دهم:
توضیحات هر قسمت:
1.	تعریف و تنظیم OptionParser
optparser = OptionParser()
optparser.add_option(
    "-f", "--inputFile", dest="input", help="filename containing csv", default=None
)
optparser.add_option(
    "-s",
    "--minSupport",
    dest="minS",
    help="minimum support value",
    default=0.15,
    type="float",
)
optparser.add_option(
    "-c",
    "--minConfidence",
    dest="minC",
    help="minimum confidence value",
    default=0.6,
    type="float",
)
o	این قسمت از کد، گزینه‌های ورودی خط فرمان را تنظیم می‌کند. سه گزینه اصلی وجود دارد:
	-f یا --inputFile برای مشخص کردن نام فایل ورودی.
	-s یا --minSupport برای تنظیم مقدار حداقل حمایت.
	-c یا --minConfidence برای تنظیم مقدار حداقل ضریب اطمینان.
2.	تجزیه گزینه‌های ورودی:
(options, args) = optparser.parse_args()
o	این خط، گزینه‌های ورودی خط فرمان را تجزیه می‌کند و مقادیر آنها را به options و args  اختصاص می‌دهد.
3.	بارگیری داده‌های ورودی:
inFile = None
if options.input is None:
    inFile = sys.stdin
elif options.input is not None:
    inFile = dataFromFile(options.input)
else:
    print("No dataset filename specified, system with exit\n")
    sys.exit("System will exit")
o	این بخش از کد، فایل ورودی را بارگیری می‌کند. اگر هیچ فایل ورودی مشخص نشده باشد، داده‌ها از ورودی استاندارد (stdin) خوانده می‌شوند.
o	در غیر این صورت، فایل مشخص شده توسط  options.input  بارگیری می‌شود. اگر هیچ فایل ورودی مشخص نشده باشد، برنامه خاتمه می‌یابد.
4.	تنظیم مقادیر حداقل حمایت و ضریب اطمینان:
minSupport = options.minS
minConfidence = options.minC
o	این خط‌ها مقادیر حداقل حمایت و ضریب اطمینان را از گزینه‌های ورودی خط فرمان استخراج می‌کنند.
5.	اجرای الگوریتم Apriori و نمایش نتایج:
items, rules = runApriori(inFile, minSupport, minConfidence)
printResults(items, rules)
o	تابع runApriori  با استفاده از داده‌های ورودی، حداقل حمایت و حداقل ضریب اطمینان، آیتم‌ست‌های پرتکرار و قوانین انجمنی را محاسبه می‌کند.
o	تابع printResults  نتایج را به صورت خوانا چاپ می‌کند.
این بخش از کد، ورودی‌های خط فرمان را مدیریت می‌کند، داده‌های ورودی را بارگیری می‌کند، و الگوریتم Apriori را اجرا می‌کند تا آیتم‌ست‌های پرتکرار و قوانین انجمنی را استخراج و نمایش دهد. این نقطه ورود اصلی برنامه است و تمامی فرآیندهای اصلی را هماهنگ می‌کند.




 
